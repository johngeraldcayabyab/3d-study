<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
</head>
<body>
<script src="tjs.js"></script>
<!--<script src="main.js"></script>-->
<script type="module">
    (async () => {
        const tjs = new TJS();
        await tjs.init();

        const module = tjs.device.createShaderModule({
            label: 'Hard coded triangle shader',
            code: await tjs.getWgsl('/web-gpu-fundamentals/fundamentals/triangle.wgsl')
        });
        const pipeline = tjs.device.createRenderPipeline({
            label: 'our hardcoded red triangle pipeline',
            layout: 'auto',
            vertex: {
                module,
                entryPoint: 'vs',
            },
            fragment: {
                module,
                entryPoint: 'fs',
                targets: [{format: tjs.presentationFormat}],
            },
            primitive: {
                topology: 'triangle-list',
            },
        });

        function frame() {
            const commandEncoder = tjs.device.createCommandEncoder({label: 'Encoder'});
            const passEncoder = commandEncoder.beginRenderPass(tjs.generateRenderPassDescriptor());
            passEncoder.setPipeline(pipeline);
            passEncoder.draw(3);
            passEncoder.end();
            const commandBuffer = commandEncoder.finish();
            tjs.device.queue.submit([commandBuffer]);
            requestAnimationFrame(frame);
        }

        requestAnimationFrame(frame);
    })();
</script>

</body>
</html>
