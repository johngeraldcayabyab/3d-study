<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello Triangle</title>
</head>
<body>
<script src="../../main.js"></script>
<script type="module">
    (async () => {
        const adapter = await getAdapter();
        const device = await adapter.requestDevice();
        const context = createContext();
        const presentationFormat = navigator.gpu.getPreferredCanvasFormat();
        context.configure({
            device,
            format: presentationFormat
        });
        const module = device.createShaderModule({
            label: 'Hard coded triangle shader',
            code: await getWgsl('/web-gpu-fundamentals/fundamentals/triangle.wgsl')
        });
        const pipeline = device.createRenderPipeline({
            label: 'our hardcoded red triangle pipeline',
            layout: 'auto',
            vertex: {
                module,
                entryPoint: 'vs',
            },
            fragment: {
                module,
                entryPoint: 'fs',
                targets: [{format: presentationFormat}],
            },
        });
        const renderPassDescriptor = {
            label: 'Render pass descriptor',
            colorAttachments: [
                {
                    view: context.getCurrentTexture().createView(),
                    clearValue: [0.3, 0.3, 0.3, 1],
                    loadOp: 'clear',
                    storeOp: 'store'
                }
            ]
        };

        function render() {
            const encoder = device.createCommandEncoder({label: 'Encoder'});
            const pass = encoder.beginRenderPass(renderPassDescriptor);
            pass.setPipeline(pipeline);
            pass.draw(3);
            pass.end();
            const commandBuffer = encoder.finish();
            device.queue.submit([commandBuffer]);
        }

        render();
    })();
</script>

</body>
</html>
